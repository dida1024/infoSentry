# ============================================
# infoSentry 环境变量配置模板
# ============================================
# 复制此文件为 .env 并填写实际值
# cp env.example .env
#
# 注意：带有 [必填] 标记的变量必须配置

# ============================================
# 基础配置
# ============================================

# [必填] 应用密钥（用于 JWT 签名等）
# 生成方法: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-here

# 环境标识
ENVIRONMENT=production

# 时区设置
TZ=Asia/Shanghai

# 日志级别 (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# ============================================
# 数据库配置 (PostgreSQL + pgvector)
# ============================================

# [必填] 数据库用户名
POSTGRES_USER=infosentry

# [必填] 数据库密码
POSTGRES_PASSWORD=your-secure-password-here

# 数据库名称
POSTGRES_DB=infosentry

# 数据库主机（docker-compose 内部使用 postgres）
POSTGRES_SERVER=postgres

# 数据库端口
POSTGRES_PORT=5432

# ============================================
# Redis 配置
# ============================================

# Redis 连接 URL（docker-compose 内部使用）
REDIS_URL=redis://redis:6379/0

# ============================================
# OpenAI API 配置
# ============================================

# [推荐] OpenAI API 密钥
# 如果不配置，embedding 和 LLM 判别将被禁用
OPENAI_API_KEY=sk-your-api-key-here

# OpenAI API 基础 URL（可选，用于兼容其他服务）
OPENAI_API_BASE=https://api.openai.com/v1

# Embedding 模型
OPENAI_EMBED_MODEL=text-embedding-3-small

# 边界判别模型
OPENAI_JUDGE_MODEL=gpt-4o-mini

# ============================================
# SMTP 邮件配置
# ============================================

# [推荐] SMTP 服务器地址
SMTP_HOST=smtp.example.com

# SMTP 端口（587=TLS, 465=SSL, 25=无加密）
SMTP_PORT=587

# [推荐] SMTP 用户名
SMTP_USER=noreply@example.com

# [推荐] SMTP 密码
SMTP_PASSWORD=your-smtp-password

# [推荐] 发件人邮箱
EMAILS_FROM_EMAIL=noreply@example.com

# 发件人名称
EMAILS_FROM_NAME=infoSentry

# ============================================
# 前后端 URL 配置
# ============================================

# [必填] 前端 URL（用于 CORS 和 Magic Link）
FRONTEND_HOST=https://your-domain.com

# [必填] 后端 URL（用于 API 调用）
BACKEND_HOST=https://api.your-domain.com

# 允许的 CORS 来源（逗号分隔）
BACKEND_CORS_ORIGINS=https://your-domain.com

# ============================================
# Feature Flags（降级开关）
# ============================================

# LLM 判别开关（关闭后边界判别全部降级 Batch）
LLM_ENABLED=true

# Embedding 开关（关闭后跳过向量化）
EMBEDDING_ENABLED=true

# Immediate 推送开关（关闭后只有 Batch/Digest）
IMMEDIATE_ENABLED=true

# 邮件发送开关（关闭后只站内通知）
EMAIL_ENABLED=true

# ============================================
# 预算控制
# ============================================

# 每日 USD 预算上限
DAILY_USD_BUDGET=0.33

# 每日 embedding 调用上限
EMBED_PER_DAY=500

# 每分钟 embedding 调用上限
EMBED_PER_MIN=300

# 每日 LLM 判别调用上限
JUDGE_PER_DAY=200

# ============================================
# 抓取配置
# ============================================

# NewsNow 抓取间隔（秒）
NEWSNOW_FETCH_INTERVAL_SEC=1800

# RSS 抓取间隔（秒）
RSS_FETCH_INTERVAL_SEC=900

# SITE 抓取间隔（秒）
SITE_FETCH_INTERVAL_SEC=1800

# 每次抓取每源最大条目数
ITEMS_PER_SOURCE_PER_FETCH=20

# ============================================
# 推送配置
# ============================================

# Immediate 合并窗口（分钟）
IMMEDIATE_COALESCE_MINUTES=5

# Immediate 单封邮件最大条目数
IMMEDIATE_MAX_ITEMS=3

# Batch 单封邮件最大条目数
BATCH_MAX_ITEMS=8

# Digest 每 Goal 最大条目数
DIGEST_MAX_ITEMS_PER_GOAL=10

# Digest 发送时间（小时，CST 时区）
DIGEST_SEND_HOUR=9

# 阈值配置
IMMEDIATE_THRESHOLD=0.93
BATCH_THRESHOLD=0.75
DIGEST_MIN_SCORE=0.60
BOUNDARY_LOW=0.88
BOUNDARY_HIGH=0.93

# ============================================
# Sentry（可选，错误追踪）
# ============================================

# Sentry DSN
# SENTRY_DSN=https://xxx@sentry.io/xxx

