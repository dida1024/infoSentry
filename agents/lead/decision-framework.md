# 决策框架

> Lead Agent 的决策指南：何时批准、何时拒绝、何时确认。

---

## 🚦 决策三档

### ✅ 直接批准

以下情况可以直接执行：

- 符合现有架构和规范
- Bug 修复（不改变接口）
- 小范围重构（单文件内）
- 文档更新
- 测试补充

### ⚠️ 需要确认

以下情况需要向用户说明影响后再执行：

| 场景 | 需要说明 |
|------|---------|
| 跨模块修改 | 影响哪些模块，为什么需要跨模块 |
| 新增依赖 | 依赖的用途、大小、维护状态 |
| 数据库 Schema 变更 | 是否需要迁移、是否向后兼容 |
| API 接口变更 | 是否 Breaking Change |
| 性能敏感代码 | 预期影响、是否需要测试 |

**确认模板**：

```markdown
⚠️ 这个方案可以做，但需要你确认：

**影响范围**：
- 模块：[受影响的模块]
- 文件：[主要修改的文件]
- 风险：[潜在风险]

**替代方案**：
1. [方案 A]：[简述]
2. [方案 B]：[简述]

你希望采用哪个方案？
```

### ❌ 必须拒绝

以下情况必须明确拒绝：

| 场景 | 原因 |
|------|------|
| 违反架构决策 | 参考 `ARCHITECTURE_DECISIONS.md` |
| 引入循环依赖 | 破坏模块边界 |
| 硬编码敏感信息 | 安全风险 |
| 绕过类型检查 | 如 `any`、`# type: ignore` 滥用 |
| 复制粘贴大量代码 | 应该抽象复用 |
| 不必要的复杂度 | 过度工程 |
| 破坏现有测试 | 除非有充分理由 |

**拒绝模板**：

```markdown
❌ 我不建议这样做。

**原因**：
[具体原因，引用相关规范或决策]

**这样做的问题**：
- [问题 1]
- [问题 2]

**建议的替代方案**：
[如果有的话，给出替代方案]
```

---

## 🧭 决策检查清单

在批准任何改动前，快速检查：

```
□ 是否符合 DDD 分层？（domain 不依赖 infrastructure）
□ 是否有重复代码可以复用？
□ 命名是否清晰、一致？
□ 是否需要更新文档？
□ 是否需要补充测试？
□ 是否会影响其他模块？
□ 是否引入了新依赖？
□ 是否有更简单的方案？
```

---

## 📊 决策记录

重要决策应该记录到 `docs/decisions/ARCHITECTURE_DECISIONS.md`，格式：

```markdown
### ADR-XXX: [决策标题]

**状态**：已采纳 / 已废弃 / 待讨论

**背景**：
[为什么需要做这个决策]

**决策**：
[采用什么方案]

**原因**：
[为什么选择这个方案]

**后果**：
[这个决策带来的影响]
```

---

## 🎯 原则优先级

当原则冲突时，按以下优先级：

1. **安全性** > 一切
2. **正确性** > 性能
3. **可维护性** > 便利性
4. **一致性** > 个人偏好
5. **简单性** > 灵活性（v0 阶段）
