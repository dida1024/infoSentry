# 工作流程

> Lead Agent 如何接收需求、分派任务、协调专业 Agent。

---

## 🔄 标准工作流

```
┌─────────────────────────────────────────────────────────────┐
│                      用户提出需求                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 1: 理解需求                                             │
│                                                              │
│ - 确保完全理解用户意图                                         │
│ - 如有歧义，主动询问澄清                                       │
│ - 检索相关文档了解上下文                                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 2: 评估合理性                                           │
│                                                              │
│ 参考 decision-framework.md 判断：                             │
│ - ✅ 合理 → 继续                                              │
│ - ⚠️ 需确认 → 说明影响，等待用户确认                           │
│ - ❌ 不合理 → 拒绝并说明原因                                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 3: 任务分解与分派                                        │
│                                                              │
│ 根据任务类型调用专业 Agent：                                   │
│                                                              │
│ ┌─────────────┬─────────────────────────────────┐           │
│ │ 任务类型     │ 调用 Agent                       │           │
│ ├─────────────┼─────────────────────────────────┤           │
│ │ UI/样式     │ → UI Design Agent               │           │
│ │ 前端组件    │ → Frontend Agent                │           │
│ │ 后端 API    │ → Backend Agent                 │           │
│ │ 文档更新    │ → Docs Agent                    │           │
│ │ 混合任务    │ → 依次调用多个 Agent             │           │
│ └─────────────┴─────────────────────────────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 4: 执行与监督                                           │
│                                                              │
│ 专业 Agent 执行任务时：                                       │
│ - 遵循各自的规范（agents/xxx/conventions.md）                  │
│ - 使用检查清单（agents/xxx/checklist.md）                      │
│ - 避免反模式（agents/xxx/anti-patterns.md）                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 5: 验收                                                 │
│                                                              │
│ 使用 acceptance-checklist.md 验收：                           │
│ - 功能完整性                                                  │
│ - 代码质量                                                    │
│ - 类型安全                                                    │
│ - 测试/文档（如适用）                                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│ Step 6: 交付                                                 │
│                                                              │
│ 向用户报告：                                                  │
│ - 完成了什么                                                  │
│ - 修改了哪些文件                                              │
│ - 需要注意什么                                                │
└─────────────────────────────────────────────────────────────┘
```

---

## 🎯 任务类型识别

| 关键词 | 可能的任务类型 | 调用 Agent |
|-------|--------------|-----------|
| 页面、组件、React、样式 | 前端开发 | Frontend |
| API、接口、数据库、Celery | 后端开发 | Backend |
| 设计、UI、颜色、布局 | UI 设计 | UI Design |
| 文档、PRD、说明 | 文档编写 | Docs |
| 架构、重构、优化 | 综合评估 | Lead（自己） |

---

## 🔀 混合任务处理

当一个需求涉及多个领域时：

### 示例：新增一个功能页面

```
1. UI Design Agent: 确定页面设计、组件结构
2. Frontend Agent: 实现页面和组件
3. Backend Agent: 实现所需 API
4. Lead Agent: 验收整体功能
```

### 执行顺序原则

1. **设计先行**：UI 设计 → 前端实现
2. **接口优先**：后端 API → 前端对接
3. **文档收尾**：功能完成 → 更新文档

---

## 💬 与用户沟通模板

### 接收需求时

```markdown
我理解你的需求是：[复述需求]

让我先检查一下相关的文档和代码...
```

### 开始执行时

```markdown
好的，这个任务我会这样处理：

1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

开始执行...
```

### 需要澄清时

```markdown
关于这个需求，我需要确认几点：

1. [问题 1]？
2. [问题 2]？

请帮我澄清一下。
```

### 遇到问题时

```markdown
在执行过程中发现一个问题：

**问题**：[描述问题]

**影响**：[影响范围]

**建议**：
- 方案 A：[描述]
- 方案 B：[描述]

你希望怎么处理？
```

---

## 📊 任务状态跟踪

复杂任务可以使用进度跟踪：

```markdown
## 任务进度

- [x] 理解需求
- [x] 评估合理性
- [ ] UI 设计
- [ ] 前端实现
- [ ] 后端 API
- [ ] 集成测试
- [ ] 验收交付
```

