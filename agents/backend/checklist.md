# 后端代码审查清单

> 完成代码后，使用此清单自查

---

## 📋 提交前检查

### 1. 架构合规

- [ ] 是否符合 DDD 分层规范？
- [ ] Domain 层是否无外部依赖？
- [ ] 是否通过 Application Service 跨模块通信？
- [ ] 新文件放在了正确的目录下？
- [ ] Interfaces 是否只依赖 Application（未直接引用 Domain 仓储/实体）？

### 2. 代码质量

- [ ] 类型注解是否完整？
- [ ] FastAPI 路由函数是否显式标注返回类型？
- [ ] 函数/类是否有必要的文档字符串？
- [ ] 命名是否清晰表达意图？
- [ ] 是否有重复代码可以抽象？

### 3. 错误处理

- [ ] 异常是否被正确捕获和处理？
- [ ] 是否避免了静默捕获（`except: pass`）？
- [ ] 业务异常是否定义在 domain 层？
- [ ] HTTP 错误响应是否符合规范？
- [ ] 接口层捕获异常时是否记录日志？

### 4. 数据库

- [ ] 是否有 N+1 查询问题？
- [ ] 是否使用了参数化查询？
- [ ] 事务边界是否正确？
- [ ] 新表/字段是否需要迁移脚本？

### 5. 性能

- [ ] 是否有不必要的数据库查询？
- [ ] 大量数据是否使用了分页？
- [ ] 是否需要添加数据库索引？
- [ ] 是否需要缓存？

### 6. 安全

- [ ] 是否验证了用户权限？
- [ ] 敏感数据是否脱敏？
- [ ] 配置是否通过环境变量？
- [ ] 是否有 SQL 注入风险？
- [ ] 分页/游标默认值是否来自配置（非硬编码）？

### 7. 日志

- [ ] 关键操作是否有日志？
- [ ] 日志级别是否正确？
- [ ] 日志是否结构化？
- [ ] 敏感信息是否从日志中排除？
- [ ] 关键业务事件是否使用 structlog/BusinessEvents 记录？

### 8. 测试

- [ ] 是否添加了单元测试？
- [ ] 边界条件是否覆盖？
- [ ] 错误路径是否测试？
- [ ] 测试是否独立（无相互依赖）？

---

## ✅ 快速检查命令

```bash
# 类型检查
uv run mypy src/

# Lint
uv run ruff check src/

# 格式化
uv run ruff format src/

# 运行测试
uv run pytest tests/

# 覆盖率
uv run pytest --cov=src --cov-report=html
```

---

## 🚨 常见问题快速定位

| 问题 | 检查点 |
|------|--------|
| 类型错误 | `mypy` 输出 |
| 导入错误 | 分层依赖是否正确 |
| 数据库错误 | 迁移是否最新 |
| 测试失败 | fixtures 是否正确 |
| API 500 | 日志中的异常堆栈 |
