# infoSentry v0 验收清单

> 依据 PRD v0 第 9/10 章编制。所有项目须在发布前完成验证。

---

## 1. 核心功能验收

### 1.1 信息摄取

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 1.1.1 | NewsNow 抓取 | 30+ 默认源正常抓取，48h 无堆积 | ☐ | | |
| 1.1.2 | RSS 抓取 | RSS 源 15 分钟轮询，解析正确 | ☐ | | |
| 1.1.3 | SITE 抓取 | 自定义选择器解析正常 | ☐ | | |
| 1.1.4 | URL 去重 | 重复 URL 不入库，无 duplicate error | ☐ | | |
| 1.1.5 | 抓取节流 | 单源请求间隔 ≥ 配置值 | ☐ | | |
| 1.1.6 | 错误退避 | 连续失败后指数退避生效 | ☐ | | |

### 1.2 向量化与匹配

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 1.2.1 | Embedding 计算 | 新条目 ≤1 分钟完成向量化 | ☐ | | |
| 1.2.2 | 匹配分数 | 语义相似度 + 词条命中 + 时效性 + 来源信任 | ☐ | | |
| 1.2.3 | 可解释原因 | match_reasons 包含具体证据 | ☐ | | |
| 1.2.4 | 预算熔断 | 超过每日预算后跳过 embedding | ☐ | | |

### 1.3 Agent 决策

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 1.3.1 | 阈值分桶 | ≥0.93 IMMEDIATE, 0.88~0.93 BOUNDARY, 0.75~0.88 BATCH | ☐ | | |
| 1.3.2 | 规则守门 | blocked_sources 阻止生效 | ☐ | | |
| 1.3.3 | 负面词过滤 | negative_terms 命中时阻止 | ☐ | | |
| 1.3.4 | STRICT 模式 | 未命中 must_terms 时阻止 | ☐ | | |
| 1.3.5 | 边界 LLM 判别 | 边界区间调用 LLM 判别 | ☐ | | |
| 1.3.6 | LLM 降级 | LLM 禁用时自动降级 BATCH | ☐ | | |
| 1.3.7 | 运行记录 | agent_runs 可查询和回放 | ☐ | | |

### 1.4 推送与邮件

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 1.4.1 | Immediate 推送 | 5 分钟窗口合并，最多 3 条 | ☐ | | |
| 1.4.2 | Batch 推送 | 按 batch_windows 时间发送，最多 8 条 | ☐ | | |
| 1.4.3 | Digest 推送 | 每日 09:00 CST 汇总，最多 10 条/Goal | ☐ | | |
| 1.4.4 | 邮件模板 | 包含 title/snippet/reason/redirect link | ☐ | | |
| 1.4.5 | 邮件去重 | dedupe_key 防止重复发送 | ☐ | | |
| 1.4.6 | SMTP 重试 | 发送失败自动重试 3 次 | ☐ | | |
| 1.4.7 | 邮件降级 | EMAIL_ENABLED=false 时只站内 | ☐ | | |

---

## 2. API 验收

### 2.1 认证接口

| 序号 | 检查项 | 验收标准 | 状态 |
|------|--------|----------|------|
| 2.1.1 | POST /api/auth/request_link | 返回 200，发送 Magic Link 邮件 | ☐ |
| 2.1.2 | GET /api/auth/consume | 有效 token 返回 JWT，无效返回 401 | ☐ |

### 2.2 Goals 接口

| 序号 | 检查项 | 验收标准 | 状态 |
|------|--------|----------|------|
| 2.2.1 | GET /api/goals | 分页返回 Goal 列表 | ☐ |
| 2.2.2 | POST /api/goals | 创建 Goal 成功 | ☐ |
| 2.2.3 | GET /api/goals/{id} | 返回 Goal 详情含高分 items | ☐ |
| 2.2.4 | PUT /api/goals/{id} | 更新 Goal 成功 | ☐ |
| 2.2.5 | POST /api/goals/{id}/pause | 暂停 Goal 成功 | ☐ |
| 2.2.6 | POST /api/goals/{id}/resume | 恢复 Goal 成功 | ☐ |

### 2.3 Sources 接口

| 序号 | 检查项 | 验收标准 | 状态 |
|------|--------|----------|------|
| 2.3.1 | GET /api/sources | 分页返回 Source 列表 | ☐ |
| 2.3.2 | POST /api/sources | 创建 Source 成功 | ☐ |
| 2.3.3 | PUT /api/sources/{id} | 更新 Source 成功 | ☐ |
| 2.3.4 | POST /api/sources/{id}/enable | 启用 Source 成功 | ☐ |
| 2.3.5 | POST /api/sources/{id}/disable | 禁用 Source 成功 | ☐ |

### 2.4 Notifications 接口

| 序号 | 检查项 | 验收标准 | 状态 |
|------|--------|----------|------|
| 2.4.1 | GET /api/notifications | 分页返回通知列表，含 reason/actions | ☐ |
| 2.4.2 | POST /api/items/{id}/feedback | 提交 like/dislike 成功 | ☐ |
| 2.4.3 | GET /r/{item_id} | 302 重定向并记录点击 | ☐ |

### 2.5 Agent/Admin 接口

| 序号 | 检查项 | 验收标准 | 状态 |
|------|--------|----------|------|
| 2.5.1 | GET /api/agent/runs | 返回 Agent 运行记录 | ☐ |
| 2.5.2 | GET /api/agent/runs/{id} | 返回详情含 tool_calls 和 ledger | ☐ |
| 2.5.3 | POST /api/agent/runs/{id}/replay | 可回放历史运行 | ☐ |
| 2.5.4 | GET /api/admin/budget | 返回预算状态 | ☐ |
| 2.5.5 | GET /api/admin/config | 返回当前配置 | ☐ |
| 2.5.6 | POST /api/admin/config | 热更新配置成功 | ☐ |
| 2.5.7 | GET /api/admin/health | 返回各组件健康状态 | ☐ |

---

## 3. 前端验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 3.1 | Magic Link 登录 | 点击邮件链接成功登录 | ☐ | | |
| 3.2 | Goal 列表 | 展示所有 Goal，支持状态过滤 | ☐ | | |
| 3.3 | Goal 创建 | 填写 description 即可创建 | ☐ | | |
| 3.4 | Goal 编辑 | 编辑所有字段并保存成功 | ☐ | | |
| 3.5 | Goal 详情 | 展示高分 items 和原因 | ☐ | | |
| 3.6 | RSS 管理 | 增删改查 RSS 源 | ☐ | | |
| 3.7 | Inbox | 展示推送通知和操作按钮 | ☐ | | |
| 3.8 | 反馈操作 | like/dislike/block 无刷新更新 | ☐ | | |
| 3.9 | 响应式 | 移动端适配正常 | ☐ | | |
| 3.10 | Chrome 兼容 | Chrome 最新版无异常 | ☐ | | |

---

## 4. 反馈与收敛验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 4.1 | 反馈写入 | item_feedback 表正确记录 | ☐ | | |
| 4.2 | Source 阻止 | blocked_sources 表正确记录 | ☐ | | |
| 4.3 | 反馈影响 | like/dislike 影响后续匹配分数 | ☐ | | |
| 4.4 | 阻止生效 | 阻止来源后不再推送该来源内容 | ☐ | | |
| 4.5 | 点击记录 | click_events 表正确记录 | ☐ | | |

---

## 5. 监控与预算验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 5.1 | 预算记录 | budget_daily 表每日更新 | ☐ | | |
| 5.2 | 熔断触发 | 超预算后 is_breaker_open=true | ☐ | | |
| 5.3 | 熔断降级 | 熔断后系统继续运行（FALLBACK） | ☐ | | |
| 5.4 | 队列告警 | >100 积压触发告警 | ☐ | | |
| 5.5 | LLM 告警 | 429 >10/h 触发告警 | ☐ | | |
| 5.6 | SMTP 告警 | 连续失败 ≥3 触发告警 | ☐ | | |
| 5.7 | 健康检查 | /admin/health 返回各组件状态 | ☐ | | |
| 5.8 | Worker 心跳 | worker_heartbeat 脚本正常运行 | ☐ | | |

---

## 6. 部署与运维验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 6.1 | Docker 部署 | docker-compose up -d 一键启动 | ☐ | | |
| 6.2 | 数据库迁移 | alembic upgrade head 成功 | ☐ | | |
| 6.3 | 环境变量 | .env.example 完整可用 | ☐ | | |
| 6.4 | 备份脚本 | backup.sh 正常备份 | ☐ | | |
| 6.5 | 恢复测试 | 从备份恢复数据成功 | ☐ | | |
| 6.6 | 热更新 | /admin/config 热更新生效 | ☐ | | |
| 6.7 | 回滚流程 | 代码回滚后服务正常 | ☐ | | |

---

## 7. 性能与稳定性验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 7.1 | 48h 运行 | 连续运行 48h 无异常 | ☐ | | |
| 7.2 | 队列无积压 | 默认源 48h 队列无持续增长 | ☐ | | |
| 7.3 | 邮件无轰炸 | 无重复邮件发送 | ☐ | | |
| 7.4 | 内存稳定 | 内存使用无持续增长 | ☐ | | |
| 7.5 | CPU 正常 | CPU 使用率 < 80% | ☐ | | |
| 7.6 | 日预算控制 | 每日 LLM 花费 < 0.33 USD | ☐ | | |

---

## 8. 故障演练验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 8.1 | OpenAI 断网 | 系统降级 BATCH，无崩溃 | ☐ | | |
| 8.2 | SMTP 错误 | 站内通知正常，邮件重试 | ☐ | | |
| 8.3 | Redis 重启 | Worker 自动恢复，无任务丢失 | ☐ | | |
| 8.4 | Worker 崩溃 | 任务不丢失，重启后继续处理 | ☐ | | |
| 8.5 | 预算耗尽 | 熔断生效，系统继续运行 | ☐ | | |

---

## 9. 测试覆盖验收

| 序号 | 检查项 | 验收标准 | 状态 | 验证人 | 日期 |
|------|--------|----------|------|--------|------|
| 9.1 | 单元测试 | 所有单元测试通过 | ☐ | | |
| 9.2 | 集成测试 | E2E 流程测试通过 | ☐ | | |
| 9.3 | 代码覆盖率 | 核心模块覆盖率 > 70% | ☐ | | |
| 9.4 | Lint 检查 | ruff check 无错误 | ☐ | | |

---

## 验收签字

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 产品负责人 | | | |
| 技术负责人 | | | |
| 测试负责人 | | | |

---

## 备注

- 所有 ☐ 项须改为 ☑ 方可发布
- 若有项目无法满足，需记录原因和替代方案
- 验收日志保存至 `docs/acceptance_logs/` 目录
